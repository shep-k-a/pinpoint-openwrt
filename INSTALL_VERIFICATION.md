# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ install.sh –∫ —á–∏—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

## ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

### 1. –ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ sing-box
- ‚úÖ DNS detour: –≤—Å–µ DNS —Å–µ—Ä–≤–µ—Ä—ã –∏–º–µ—é—Ç `"detour": "direct-out"`
- ‚úÖ route.final: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `"final": "direct-out"`
- ‚úÖ TUN inbound: –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é (address/inet4_address)
- ‚úÖ direct-out: –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–≥ `"tag": "direct-out"`
- ‚úÖ dns-out: –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ LuCI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ pinpoint.uc —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∏–∑ GitHub (master branch - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ rpcd –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- ‚úÖ –ö—ç—à LuCI –æ—á–∏—â–∞–µ—Ç—Å—è (`rm -rf /tmp/luci-*`)
- ‚úÖ UCI –∫–æ–Ω—Ñ–∏–≥ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ú–µ–Ω—é –ø—É—Ç—å: `admin/services/pinpoint`

### 3. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ pinpoint.uc (—Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∏–∑ GitHub)
- ‚úÖ `run_cmd` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥ `clean_config_outbounds`
- ‚úÖ –ó–∞–º–µ–Ω—ë–Ω `server.address.match()` –Ω–∞ `match()`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ `split(trim(...))` –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ü–∏–∫–ª—ã `for...in` –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤
- ‚úÖ `clean_config_outbounds` –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç outbounds (VPN –ø–µ—Ä–≤—ã–º)
- ‚úÖ `clean_config_outbounds` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `route.final` –Ω–∞ –ø–µ—Ä–≤—ã–π VPN
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏

### 4. NFTables –∏ Routing
- ‚úÖ Fwmark: `0x1` (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ)
- ‚úÖ IP rule priority: `50`
- ‚úÖ Prerouting hook: `priority raw - 1`
- ‚úÖ Conntrack marking –ø—Ä–∞–≤–∏–ª–∞
- ‚úÖ Masquerade –¥–ª—è tun1

## üì¶ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —á–∏—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ sing-box
1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `opkg` –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è OpenWRT
2. –ó–∞—Ç–µ–º: `opkg` –∏–∑ ImmortalWRT —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. –ó–∞—Ç–µ–º: –ü—Ä—è–º–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑ ImmortalWRT
4. –ó–∞—Ç–µ–º: GitHub SagerNet (pinned version) —Å MIPS variants
5. –ó–∞—Ç–µ–º: GitHub SagerNet (latest release)
6. –ó–∞—Ç–µ–º: –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–ª—è MIPS —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ sing-box
```json
{
  "dns": {
    "servers": [
      {"tag": "google", "address": "8.8.8.8", "detour": "direct-out"},
      {"tag": "local", "address": "127.0.0.1", "detour": "direct-out"}
    ]
  },
  "inbounds": [
    {
      "type": "tun",
      "tag": "tun-in",
      "inet4_address": "10.0.0.1/30",  // –∏–ª–∏ "address" –¥–ª—è < 1.11.0
      ...
    }
  ],
  "outbounds": [
    {"type": "direct", "tag": "direct-out"},
    {"type": "dns", "tag": "dns-out"}
  ],
  "route": {
    "rules": [{"protocol": "dns", "outbound": "dns-out"}],
    "final": "direct-out",
    "auto_detect_interface": true
  }
}
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ LuCI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è `pinpoint.uc` –∏–∑ GitHub (master - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è —Å–æ –≤—Å–µ–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏)
- –°–æ–∑–¥–∞—ë—Ç—Å—è `/etc/config/pinpoint`
- –û—á–∏—â–∞–µ—Ç—Å—è –∫—ç—à LuCI
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `rpcd`
- –ú–µ–Ω—é –¥–æ—Å—Ç—É–ø–Ω–æ: **Services ‚Üí PinPoint**

### –®–∞–≥ 4: –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç subscription URL —á–µ—Ä–µ–∑ UI
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `update_subscriptions()`**
3. –ü–æ–¥–ø–∏—Å–∫–∞ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∏ –ø–∞—Ä—Å–∏—Ç—Å—è
4. –¢—É–Ω–Ω–µ–ª–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥
5. `clean_config_outbounds()`:
   - –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç: VPN —Ç—É–Ω–Ω–µ–ª–∏ ‚Üí direct-out ‚Üí dns-out
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `route.final` –Ω–∞ –ø–µ—Ä–≤—ã–π VPN —Ç—É–Ω–Ω–µ–ª—å
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç DNS detour
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç TUN inbound
6. –ö–æ–Ω—Ñ–∏–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
7. sing-box –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
8. **–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!** ‚ú®

## ‚úÖ –ò—Ç–æ–≥

**–ü–æ—Å–ª–µ —á–∏—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
- ‚úÖ Sing-box —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–æ–Ω—Ñ–∏–≥–æ–º
- ‚úÖ DNS –Ω–µ —Å–æ–∑–¥–∞—ë—Ç loopback
- ‚úÖ LuCI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- ‚úÖ VPN —Ç—É–Ω–Ω–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
- ‚úÖ –¢—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ VPN –¥–ª—è –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ **–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä—É—á–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫!**

## üîó –°—Å—ã–ª–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
curl -fsSL https://raw.githubusercontent.com/shep-k-a/pinpoint-openwrt/master/install.sh | sh
```

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
1. –û—Ç–∫—Ä—ã—Ç—å LuCI: `http://<router-ip>/cgi-bin/luci/admin/services/pinpoint`
2. Tunnels ‚Üí Add Subscription ‚Üí –≤—Å—Ç–∞–≤–∏—Ç—å URL
3. **–ü–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è!**
4. Services ‚Üí Enable –Ω—É–∂–Ω—ã–µ (Instagram, YouTube, etc.)
5. Update Services
6. **–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ
